<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Giá bạc - Kim Hoàng Bảy Chanh</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Chuyên các sản phẩm bạc uy tín, chất lượng, giao hàng nhanh toàn quốc. Đổi trả dễ dàng, tư vấn tận tâm.">
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3176/3176367.png">
  <!-- Font đẹp -->
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #e2c275;
      --gold-dark: #bfa046;
      --black: #181818;
      --white: #fff;
      --gray: #282828;
      --shadow: 0 8px 32px #0006;
    }
    body {
      background: var(--black);
      color: var(--white);
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0; padding: 0;
      font-size: 1.07em;
    }
    h1 {
      font-family: 'Playfair Display', serif;
      color: var(--gold);
      text-align: center;
      font-size: 2.7em;
      margin: 30px 0 10px 0;
      letter-spacing: 3px;
      text-shadow: 0 2px 12px #000a;
    }
    #promo-banner {
      background: linear-gradient(90deg, var(--gray) 60%, var(--gold-dark) 100%);
      color: var(--gold);
      padding: 16px 0;
      font-size: 1.17em;
      text-align: center;
      letter-spacing: 1px;
      font-weight: bold;
      box-shadow: var(--shadow);
      text-shadow: 0 2px 8px #000c;
    }
    #contact-bar {
      background: var(--gray);
      color: var(--gold);
      text-align: center;
      font-size: 1.13em;
      padding: 10px 0;
      border-bottom: 1.5px solid var(--gold-dark);
      box-shadow: 0 2px 12px #0005;
    }
    #contact-bar a, #contact-bar .gmail {
      color: var(--gold);
      font-weight: bold;
      text-decoration: none;
      margin: 0 8px;
      transition: color .15s;
    }
    #contact-bar a:hover, #contact-bar .gmail:hover { color: var(--white); }
    #contact-bar .gmail { color: #ffe799; }
    #contact-bar .workhours { color: #ffe799; margin-left:10px; }
    #policy-link {
      text-align:center;
      margin: 24px 0 16px 0;
    }
    #policy-link a {
      color: var(--gold);
      font-weight: bold;
      font-size: 1.08em;
      text-decoration: none;
      border-bottom: 2px solid var(--gold-dark);
      padding-bottom: 2px;
      transition: color .18s, border .18s;
    }
    #policy-link a:hover { color: var(--white); border-color: var(--white);}
    #search-bar {
      text-align:center;
      margin: 30px 0 16px 0;
    }
    #search-bar input[type="text"] {
      width:300px; padding:12px; border-radius:8px; border:1.5px solid var(--gold-dark);
      background: var(--gray); color: var(--white);
      font-size:1em; max-width:90vw; outline: none;
      margin-right: 6px;
      box-shadow: 0 2px 14px #0005;
      transition: border .18s;
    }
    #search-bar input[type="text"]:focus {
      border-color: var(--gold);
    }
    #search-bar button {
      padding:12px 28px;
      border-radius:8px;
      background: linear-gradient(90deg, var(--gold-dark), var(--gold));
      color: var(--black);
      font-weight:bold;
      border:none;
      cursor:pointer;
      font-size:1em;
      transition:background .18s, color .18s, box-shadow .18s;
      box-shadow: 0 2px 8px #bfa04655;
    }
    #search-bar button:hover {
      background: linear-gradient(90deg, #b08a2e, #ffe9b0);
      color: var(--black);
      box-shadow: 0 8px 28px #bfa04688;
    }
    #featured-products, #testimonials, #catalogue, #policy, #address {
      border-radius: 20px;
      margin: 30px auto 24px;
      box-shadow: var(--shadow);
      background: #181818ee;
      padding: 24px 20px;
      max-width: 950px;
    }
    #featured-products h2, #testimonials h2 {
      color: var(--gold);
      text-align: center;
      margin-bottom: 22px;
      font-family: 'Playfair Display', serif;
      font-size: 2em;
      letter-spacing: 1.5px;
    }
    #featured-list {
      display:flex; flex-wrap:wrap; gap:28px; justify-content:center;
    }
    .featured-item {
      background: #23231f;
      border-radius: 16px;
      box-shadow: 0 4px 20px #bfa04633, 0 1px 8px #0005;
      padding: 18px 12px;
      text-align: center;
      width: 240px;
      max-width: 95vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform .22s, box-shadow .22s;
      opacity: 0.97;
    }
    .featured-item:hover {
      transform: translateY(-7px) scale(1.035);
      box-shadow: 0 8px 32px #bfa04688;
      opacity: 1;
    }
    .featured-item img {
      width: 210px; height: 210px; object-fit:cover;
      border-radius: 12px;
      background: var(--white);
      margin-bottom: 10px;
      border: 3px solid var(--gold-dark);
      box-shadow: 0 2px 16px #bfa04644;
      transition: transform .18s;
    }
    .featured-item:hover img { transform:scale(1.06);}
    .badge-hot {
      display:inline-block;
      background: linear-gradient(90deg, #bfa046, #ffe9b0);
      color: #222;
      font-size:1em; font-weight:bold;
      padding: 4px 14px;
      border-radius: 9px;
      margin-bottom: 9px;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px #bfa04633;
    }
    .order-btn, #popup-mess {
      margin-top:13px;
      background: linear-gradient(90deg, #bfa046, #ffe9b0);
      color: #222;
      font-weight: bold;
      padding: 12px 32px;
      border-radius: 8px;
      font-size: 1.08em;
      text-decoration: none;
      border: none;
      cursor: pointer;
      box-shadow: 0 3px 12px #bfa04677;
      transition: background .19s, color .19s, box-shadow .14s;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }
    .order-btn:hover, #popup-mess:hover {
      background: linear-gradient(90deg, #a6842a, #fceabb);
      color: var(--black);
      box-shadow: 0 10px 30px #bfa046bb;
    }
    #testimonials-list {
      display: flex;
      flex-wrap: wrap;
      gap: 22px;
      justify-content: center;
    }
    .testimonial {
      background: #212116;
      border-radius: 12px;
      box-shadow: 0 2px 10px #bfa04633;
      padding: 20px 18px;
      width: 260px;
      font-size: 1.07em;
      color: var(--gold);
      line-height: 1.6;
    }
    #catalogue {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 32px;
      margin: 40px 0 10px 0;
      padding: 0 8px;
      background: #181818ee;
    }
    .catalogue-item {
      background: #23231f;
      border-radius: 18px;
      padding: 38px 50px;
      font-size: 2em;
      font-weight: bold;
      color: var(--gold);
      cursor: pointer;
      box-shadow: 0 2px 8px #bfa04633, 0 2px 12px #0003;
      text-align: center;
      border: 2.5px solid #bfa046;
      min-width:120px;
      transition: background .2s, color .2s, transform .18s, box-shadow .2s;
    }
    .catalogue-item:hover {
      background: var(--gold);
      color: #181818;
      transform: translateY(-6px) scale(1.06);
      border: 2.5px solid var(--gold-dark);
      box-shadow: 0 10px 36px #bfa04677;
    }
    #filter-area {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
      margin: 20px 0 10px 0;
      flex-wrap: wrap;
    }
    .filter-btn {
      background: #23231f;
      border: 2.5px solid #bfa046;
      color: var(--gold);
      font-weight: bold;
      font-size: 1em;
      border-radius: 8px;
      padding: 12px 26px;
      cursor: pointer;
      margin-bottom: 6px;
      transition: background .18s, color .18s, border .18s, box-shadow .18s;
      box-shadow: 0 2px 8px #bfa04633;
    }
    .filter-btn.selected,.filter-btn:hover {
      background: var(--gold);
      color: #181818;
      border: 2.5px solid var(--gold-dark);
      box-shadow: 0 4px 16px #bfa04644;
    }
    #data {
      display: grid;
      grid-template-columns: repeat(2,1fr);
      gap: 36px 36px;
      justify-items: center;
      align-items: start;
      margin-bottom: 16px;
      padding: 0 8px;
    }
    .item {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #23231f;
      padding: 28px 20px;
      border-radius: 20px;
      box-shadow: 0 4px 24px #bfa04633;
      width: 440px;
      max-width: 98vw;
      position: relative;
      transition: transform .22s, box-shadow .18s, opacity .38s, filter .38s;
      opacity: 0.96;
    }
    .item.show {
      opacity:1;
      transform: translateY(0) scale(1);
    }
    .item:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: 0 12px 42px #bfa04688, 0 2px 12px #0005;
      opacity: 1;
    }
    .item img {
      width: 370px;
      height: 370px;
      margin-bottom: 20px;
      object-fit: cover;
      cursor: pointer;
      border-radius: 12px;
      box-shadow: 0 4px 18px #bfa04633;
      border: 3px solid var(--gold-dark);
      max-width: 96vw;
      aspect-ratio: 1/1;
      background: var(--white);
      transition: transform .18s;
    }
    .item:hover img { transform: scale(1.04);}
    .item p {
      margin: 0;
      font-size: 1.4em;
      color: var(--gold);
      line-height: 1.5;
      text-align: center;
      word-break: break-word;
    }
    #pagination {
      text-align: center;
      margin: 30px 0 10px 0;
    }
    #pagination button {
      padding: 12px 24px;
      font-size: 1.1em;
      margin: 0 12px;
      border: none;
      background: linear-gradient(90deg, var(--gold-dark), var(--gold));
      color: var(--black);
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 8px #bfa04633;
      transition: background .18s, box-shadow .14s;
    }
    #pagination button:disabled {
      background: #aaa;
      cursor: not-allowed;
      color: #fff;
      box-shadow: none;
    }
    #pagination span {
      font-size: 1.2em;
      margin: 0 10px;
      font-weight: bold;
      color: var(--gold);
    }
    #backbtn {
      display: inline-block;
      margin: 22px 0 7px 25px;
      padding: 12px 26px;
      font-size: 1.1em;
      background: #23231f;
      color: var(--gold);
      border: 2.5px solid #bfa046;
      border-radius: 9px;
      cursor: pointer;
      font-weight: bold;
      transition: background .17s, color .19s;
    }
    #backbtn:hover { background: var(--gold); color: #222;}
    #policy {
      max-width: 650px;
      background: #23231f;
      color: var(--gold);
      border-radius: 18px;
      box-shadow: 0 2px 18px #bfa04633;
      padding: 40px 28px;
    }
    #policy h2 { color: var(--gold); margin-top: 0;}
    #policy ul { font-size: 1.17em; line-height: 1.7; padding-left: 20px;}
    #order-popup {
      opacity:0; pointer-events:none; transition:opacity 0.25s; display:none;
      align-items:center; justify-content:center;
      position:fixed; left:0; top:0; width:100vw; height:100vh;
      background:rgba(30,30,15,0.7); z-index:99;
    }
    #order-popup.show {opacity:1; pointer-events:auto; display:flex;}
    #order-popup .popup-inner {
      background: #212116;
      min-width:320px; max-width:96vw; padding:32px 24px;
      border-radius:14px; box-shadow: 0 2px 18px #bfa04688;
      text-align: center; position: relative;
      transform: scale(0.85); opacity: 0;
      transition: all .27s cubic-bezier(.23,1.24,.4,1);
    }
    #order-popup.show .popup-inner { transform:scale(1); opacity:1;}
    #order-popup .popup-inner button.close {
      position:absolute; top:8px; right:12px; background:none; border:none;
      font-size:2em; color: var(--gold); cursor:pointer;
    }
    #loader {display:none; justify-content:center; align-items:center; margin:30px 0;}
    .skeleton {
      background: #23231f;
      border-radius: 10px;
      margin: 12px auto;
      width: 90vw; max-width:410px; height:360px;
      animation: skel 1.2s infinite linear;
      box-shadow: 0 2px 12px #bfa04644;
    }
    @keyframes skel {0%{opacity:.8;}50%{opacity:.4;}100%{opacity:.8;}}
    .scroll-fade { opacity:0; transform:translateY(60px); transition:all 0.7s cubic-bezier(.2,.8,.4,1.1);}
    .scroll-fade.visible { opacity:1; transform:translateY(0);}
    #address {
      max-width: 600px; margin:32px auto 32px;
      background: #212116;
      color: var(--gold);
      padding: 22px 18px 22px 60px;
      border-radius:16px;
      box-shadow: 0 2px 14px #bfa04633;
      position:relative; font-size:1.15em; line-height:1.7;
    }
    #address span {
      position:absolute; left:18px; top:22px; font-size:1.6em; color: var(--gold);
    }
    #address a { color: var(--gold); text-decoration:underline;}
    #address iframe {margin-top:12px; border-radius:13px; overflow:hidden; box-shadow:0 1px 8px #bfa04622;}
    #floating-chat {
      position:fixed; bottom:30px; right:30px; z-index:1000;
      display:flex; flex-direction:column; gap:10px;
    }
    #floating-chat img {
      width:52px; height:52px; border-radius:50%;
      box-shadow: 0 2px 12px #bfa04655;
      background: #fff;
      border: 2.5px solid var(--gold-dark);
    }
    footer {
      background: #181818;
      color: var(--gold);
      padding: 32px 6vw 18px 6vw;
      margin-top: 46px;
      text-align: center;
      font-size: 1.13em;
      border-top: 2.5px solid var(--gold-dark);
      letter-spacing: 1px;
      box-shadow: 0 -2px 20px #bfa04644;
    }
    footer .gmail { color: #ffe799;}
    footer .workhours { color: #ffe799;}
    @media (max-width:900px){
      #data { grid-template-columns:1fr; }
      .item img {width:94vw; max-width:98vw; height:auto;}
      .item {width:98vw;}
      #policy, #address {padding:18px 4vw;}
      #featured-list { flex-direction: column; gap: 18px;}
      .featured-item { width:96vw; max-width:96vw;}
    }
  </style>
</head>
<body>
  <!-- Banner khuyến mãi -->
  <div id="promo-banner">
    🎁 FREESHIP cho hóa đơn từ 500k! &nbsp;|&nbsp; 
    🎉 Giảm 10% cho khách mua vào ngày và tháng trùng nhau (VD: 05/05, 12/12)! &nbsp;|&nbsp; 
    🏷️ Tặng hộp quà cho mọi đơn hàng!
  </div>
  <h1>Giá bạc</h1>
  <div id="contact-bar">
    <span><b>Hotline/Zalo:</b> <a href="tel:0972512865">0972512865</a></span> &nbsp;|&nbsp;
    <span><b>Email:</b> <a class="gmail" href="mailto:hsck19956@gmail.com">hsck19956@gmail.com</a></span> &nbsp;|&nbsp;
    <span class="workhours"><b>Giờ làm việc:</b> 7h00 - 19h00 (T2 - CN)</span> &nbsp;|&nbsp;
    <a href="https://zalo.me/0972512865" target="_blank">Chat Zalo</a> &nbsp;|&nbsp;
    <a href="https://m.me/thuhien18102" target="_blank">Chat Messenger</a>
  </div>
  <div id="policy-link">
    <a href="#policy">Chính sách</a>
  </div>
  <div id="search-bar">
    <input id="search-input" type="text" placeholder="Tìm sản phẩm theo tên hoặc mã...">
    <button onclick="searchProduct()">Tìm kiếm</button>
  </div>
  <div id="loader"></div>
  <div id="featured-products" class="scroll-fade">
    <h2>Sản phẩm nổi bật</h2>
    <div id="featured-list"></div>
  </div>
  <div id="testimonials" class="scroll-fade">
    <h2>Khách hàng nhận xét</h2>
    <div id="testimonials-list"></div>
  </div>
  <div id="catalogue" class="scroll-fade"></div>
  <button id="backbtn" style="display:none" onclick="showCatalogue()">← Quay về danh mục</button>
  <div id="filter-area" style="display:none"></div>
  <div id="data" style="display:none"></div>
  <div id="pagination" style="display:none"></div>
  <div id="policy" class="scroll-fade">
    <h2>Chính sách đổi trả & giao hàng</h2>
    <ul>
      <li><b>Đổi trả:</b> Sản phẩm được đổi/trả trong vòng <b>5 ngày</b> nếu còn nguyên vẹn, chưa qua sử dụng, không bị trầy xước, móp méo, còn đầy đủ hộp, phụ kiện (nếu có).</li>
      <li><b>Giao hàng nội tỉnh:</b> Phí ship 20.000đ/đơn.</li>
      <li><b>Giao hàng ngoài tỉnh:</b> Phí ship 25.000đ/đơn.</li>
      <li>Thời gian giao hàng dự kiến: từ 1-5 ngày tuỳ khu vực.</li>
      <li>Mọi thắc mắc hoặc đổi trả, liên hệ <a href="mailto:hsck19956@gmail.com">hsck19956@gmail.com</a> hoặc Zalo/SĐT <a href="tel:0972512865">0972512865</a>.</li>
    </ul>
  </div>
  <div id="address" class="scroll-fade">
    <span>📍</span>
    <b>Địa chỉ:</b>
    <a href="https://www.google.com/maps/place/Doanh+Nghi%E1%BB%87p+T%C6%B0+Nh%C3%A2n+Kim+Ho%C3%A0ng+B%E1%BA%A3y+Chanh/@9.3688065,105.8921107,20.71z/data=!4m6!3m5!1s0x31a1ac4000000001:0xcf6f8131e7d41453!8m2!3d9.3688306!4d105.8920296!16s%2Fg%2F11csrpr1mg?entry=ttu"
    target="_blank">
      Doanh Nghiệp Tư Nhân Kim Hoàng Bảy Chanh
    </a>
    <div>
      <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3912.646630752199!2d105.8920296!3d9.3688306!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31a1ac4000000001%3A0xcf6f8131e7d41453!2zRG9hbmggTmdoxKlhcCBUxrAgTmjDoW4gS2ltIEhvw6BuZyBC4bqjbSBDaGFuaA!5e0!3m2!1svi!2s!4v1688163869918!5m2!1svi!2s"
        width="100%" height="220" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </div>
  <!-- Popup order -->
  <div id="order-popup">
    <div class="popup-inner">
      <button class="close" onclick="closeOrderPopup()">×</button>
      <h3 style="color:#e2c275;margin-top:0;font-family:'Playfair Display',serif;">Đặt hàng nhanh</h3>
      <div id="popup-content"></div>
      <a id="popup-mess" href="#" target="_blank" class="ripple-btn">Gửi Messenger</a>
    </div>
  </div>
  <!-- Nút chat nổi -->
  <div id="floating-chat">
    <a href="https://zalo.me/0972512865" target="_blank" title="Chat Zalo">
      <img src="https://static-zalo.zadn.vn/oa/zalo-oa-logo.png" alt="Chat Zalo">
    </a>
    <a href="https://m.me/thuhien18102" target="_blank" title="Chat Messenger">
      <img src="https://cdn-icons-png.flaticon.com/512/124/124019.png" alt="Chat Messenger">
    </a>
  </div>
  <footer>
    <div>
      <b>Hotline/Zalo:</b> <a href="tel:0972512865">0972512865</a> &nbsp;|&nbsp;
      <b>Email:</b> <a class="gmail" href="mailto:hsck19956@gmail.com">hsck19956@gmail.com</a> &nbsp;|&nbsp;
      <span class="workhours"><b>Giờ làm việc:</b> 7h00 - 19h00 (T2 - CN)</span>
    </div>
    <div style="margin-top:8px;font-size:0.98em;color:#ffe799;">
      © 2025 Kim Hoàng Bảy Chanh. All rights reserved.
    </div>
  </footer>
  <script>
    // Hiệu ứng xuất hiện khi cuộn
    function scrollFadeIn() {
      document.querySelectorAll('.scroll-fade').forEach(el=>{
        const rect = el.getBoundingClientRect();
        if(rect.top < window.innerHeight-60) el.classList.add('visible');
      });
    }
    window.addEventListener('scroll', scrollFadeIn);
    window.addEventListener('DOMContentLoaded', scrollFadeIn);

    function removeVietnameseTones(str) {
      return str.normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/đ/g, 'd').replace(/Đ/g, 'D');
    }

    const categories = [
      { key: "day", label: "DÂY", keyword: "day" },
      { key: "nhan", label: "NHẪN", keyword: "nhan" },
      { key: "lac", label: "LẮC", keyword: "lac" },
      { key: "vong", label: "VÒNG", keyword: "vong" },
      { key: "da", label: "ĐÁ", keyword: "da" },
      { key: "bong", label: "BÔNG", keyword: "bong" }
    ];
    const priceFilters = [
      { key: "all", label: "Tất cả", fn: _ => true },
      { key: "lt500", label: "< 500k", fn: gia => gia > 0 && gia < 500000 },
      { key: "500to1tr", label: "500k - 1tr", fn: gia => gia >= 500000 && gia < 1000000 },
      { key: "1trto2tr", label: "1tr - 2tr", fn: gia => gia >= 1000000 && gia < 2000000 },
      { key: "gt2tr", label: "> 2tr", fn: gia => gia >= 2000000 }
    ];
    const jsonUrl = 'https://raw.githubusercontent.com/hoangsang26061995/bac/main/giabac.json';
    const imgBaseUrl = 'https://raw.githubusercontent.com/hoangsang26061995/anhbac/main/';
    const itemsPerPage = 20;
    let dataAll = [];
    let productsByCat = {};
    let currentCategory = '';
    let currentPage = 1;
    let totalPage = 1;
    let selectedPriceFilter = "all";

    // Đánh giá khách hàng thay đổi mỗi ngày
    const allReviews = [
      {star:5, text:'“Sản phẩm đẹp, giao hàng nhanh, shop tư vấn nhiệt tình!”', user:'Lan, Cần Thơ'},
      {star:5, text:'“Đổi trả dễ dàng, mình rất hài lòng!”', user:'Hùng, Hậu Giang'},
      {star:5, text:'“Bạc sáng bóng, đóng gói cẩn thận. Sẽ ủng hộ tiếp!”', user:'Thu, Sóc Trăng'},
      {star:5, text:'“Ảnh thật giống như shop đăng, giá hợp lý.”', user:'Bình, Vĩnh Long'},
      {star:4, text:'“Phục vụ tốt, lần sau sẽ giới thiệu bạn bè.”', user:'Thủy, Cần Thơ'},
      {star:5, text:'“Đặt hàng dễ dàng, nhân viên hỗ trợ nhiệt tình.”', user:'Vũ, Đồng Tháp'}
    ];
    function renderTestimonials() {
      const d = new Date();
      const seed = d.getFullYear()*400 + d.getMonth()*31 + d.getDate();
      function seededRandom(s) {
        var x = Math.sin(s) * 10000; return x - Math.floor(x);
      }
      let idx = allReviews.map((r,i)=>i);
      idx.sort((a,b)=>seededRandom(seed+a)-seededRandom(seed+b));
      let html = '';
      for(let i=0;i<2;i++) {
        const rv = allReviews[idx[i]];
        html += `<div class="testimonial">
          <span style="font-size:2em;color:#e2c275;">${'★ '.repeat(rv.star).trim()}</span><br>
          ${rv.text}<br>
          <i>- ${rv.user}</i>
        </div>`;
      }
      document.getElementById('testimonials-list').innerHTML = html;
    }

    // Loading skeleton
    function showLoader(n) {
      const loader = document.getElementById('loader');
      loader.style.display = 'flex';
      let s = '';
      for(let i=0;i<n;i++) s += '<div class="skeleton"></div>';
      loader.innerHTML = s;
    }
    function hideLoader() {
      document.getElementById('loader').style.display = 'none';
    }

    // Tìm kiếm sản phẩm (ưu tiên tìm đúng MS nếu nhập số, nếu chỉ có 1 kết quả sẽ mở popup với hình và giá)
    function searchProduct() {
      const kw = document.getElementById('search-input').value.trim().toLowerCase();
      if (!kw) {
        showCatalogue();
        return;
      }
      let result = [];
      if (!isNaN(kw)) {
        for (const cat in productsByCat) {
          const found = productsByCat[cat].find(
            item => (item.ms && item.ms.toString().toLowerCase() === kw)
          );
          if (found) {
            result = [found];
            break;
          }
        }
      }
      if (result.length === 0) {
        for (const cat in productsByCat) {
          result = result.concat(productsByCat[cat].filter(
            item =>
              (item.ms && item.ms.toString().toLowerCase().includes(kw)) ||
              (item["tên"] && removeVietnameseTones(item["tên"].toLowerCase()).includes(removeVietnameseTones(kw)))
          ));
        }
      }
      // Nếu tìm thấy 1 sản phẩm, mở popup luôn (và truyền hình/gia)
      if (result.length === 1) {
        openOrderPopup(result[0].ms, result[0]["tên"], result[0]["giá"], imgBaseUrl + result[0].ms + ".jpg");
        document.getElementById('search-input').value = '';
        return;
      }
      document.getElementById('catalogue').style.display = 'none';
      document.getElementById('backbtn').style.display = 'inline-block';
      document.getElementById('filter-area').style.display = 'none';
      document.getElementById('data').style.display = 'grid';
      document.getElementById('pagination').style.display = 'none';
      renderSearchResult(result, kw);
    }
    function renderSearchResult(result, kw) {
      const dataDiv = document.getElementById('data');
      dataDiv.innerHTML = '';
      if(result.length === 0) {
        dataDiv.innerHTML = `<div style="font-size:1.3em;grid-column:span 2;text-align:center;color:#ffe799;margin:24px 0">
          Không tìm thấy sản phẩm phù hợp với "<b>${kw}</b>".
        </div>`;
        return;
      }
      result.forEach((item,i) => {
        const div = document.createElement('div');
        div.className = 'item';
        setTimeout(()=>div.classList.add('show'),80+i*45);
        const img = document.createElement('img');
        img.src = imgBaseUrl + item.ms + '.jpg';
        img.alt = item["tên"] || '';
        img.title = item["MÔ TẢ"] || '';
        div.appendChild(img);
        const p = document.createElement('p');
        p.innerHTML =
          `<b>MS:</b> ${item.ms}<br>` +
          `<b>Tên:</b> ${item["tên"]}<br>` +
          `<b>Giá:</b> ${item["giá"]}`;
        div.appendChild(p);
        const orderBtn = document.createElement('button');
        orderBtn.textContent = 'ĐẶT HÀNG';
        orderBtn.className = 'order-btn ripple-btn';
        orderBtn.onclick = function(e) {
          openOrderPopup(item.ms, item["tên"], item["giá"], imgBaseUrl + item.ms + ".jpg");
          rippleEffect(e,this);
        };
        div.appendChild(orderBtn);
        dataDiv.appendChild(div);
      });
      rippleBtnInit();
    }

    // Sản phẩm nổi bật
    function showFeaturedProducts() {
      const featuredList = document.getElementById('featured-list');
      if (!featuredList) return;
      featuredList.innerHTML = '';
      const featured = dataAll.slice(0,4);
      featured.forEach((item,i) => {
        const div = document.createElement('div');
        div.className = 'featured-item';
        setTimeout(()=>div.style.opacity=1,130+i*120);
        const badge = document.createElement('div');
        badge.className = 'badge-hot';
        badge.textContent = 'Nổi bật';
        div.appendChild(badge);
        const img = document.createElement('img');
        img.src = imgBaseUrl + item.ms + '.jpg';
        img.alt = item["tên"] || '';
        img.title = item["MÔ TẢ"] || '';
        div.appendChild(img);
        const p = document.createElement('p');
        p.innerHTML = `<b>${item["tên"]}</b><br>MS: ${item.ms}<br>Giá: ${item["giá"]}`;
        div.appendChild(p);
        const orderBtn = document.createElement('button');
        orderBtn.textContent = 'ĐẶT HÀNG';
        orderBtn.className = 'order-btn ripple-btn';
        orderBtn.onclick = function(e) {
          openOrderPopup(item.ms, item["tên"], item["giá"], imgBaseUrl + item.ms + ".jpg");
          rippleEffect(e,this);
        };
        div.appendChild(orderBtn);
        featuredList.appendChild(div);
      });
      rippleBtnInit();
    }

    function showCatalogue() {
      document.getElementById('catalogue').style.display = 'flex';
      document.getElementById('backbtn').style.display = 'none';
      document.getElementById('filter-area').style.display = 'none';
      document.getElementById('data').style.display = 'none';
      document.getElementById('pagination').style.display = 'none';
      selectedPriceFilter = "all";
    }
    function showCategory(catKey) {
      currentCategory = catKey;
      currentPage = 1;
      selectedPriceFilter = "all";
      document.getElementById('catalogue').style.display = 'none';
      document.getElementById('backbtn').style.display = 'inline-block';
      document.getElementById('filter-area').style.display = 'flex';
      document.getElementById('data').style.display = 'grid';
      document.getElementById('pagination').style.display = 'block';
      renderPriceFilters();
      renderPage(currentPage);
    }
    function renderPriceFilters() {
      const area = document.getElementById('filter-area');
      area.innerHTML = '';
      priceFilters.forEach(flt => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn' + (selectedPriceFilter === flt.key ? ' selected' : '');
        btn.textContent = flt.label;
        btn.onclick = () => {
          selectedPriceFilter = flt.key;
          currentPage = 1;
          renderPriceFilters();
          renderPage(currentPage);
        };
        area.appendChild(btn);
      });
    }
    function parseGia(str) {
      if (!str) return 0;
      let s = (str + '').replace(/[^0-9]/g, '');
      return parseInt(s, 10) || 0;
    }
    function renderPage(page) {
      showLoader(2);
      setTimeout(()=>{
      let products = productsByCat[currentCategory] || [];
      const pf = priceFilters.find(f => f.key === selectedPriceFilter) || priceFilters[0];
      products = products.filter(item => pf.fn(parseGia(item["giá"])));
      totalPage = Math.ceil(products.length / itemsPerPage) || 1;
      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const data = products.slice(start, end);
      const dataDiv = document.getElementById('data');
      dataDiv.innerHTML = '';
      if(data.length === 0) {
        dataDiv.innerHTML = '<div style="font-size:1.5em;grid-column:span 2;text-align:center;color:#ffe799;margin:30px 0">Không có sản phẩm nào phù hợp.</div>';
      }
      data.forEach((item,i) => {
        const div = document.createElement('div');
        div.className = 'item';
        setTimeout(()=>div.classList.add('show'),80+i*45);
        const img = document.createElement('img');
        img.src = imgBaseUrl + item.ms + '.jpg';
        img.alt = item["tên"] || '';
        img.title = item["MÔ TẢ"] || '';
        div.appendChild(img);
        const p = document.createElement('p');
        p.innerHTML =
          `<b>MS:</b> ${item.ms}<br>` +
          `<b>Tên:</b> ${item["tên"]}<br>` +
          `<b>Giá:</b> ${item["giá"]}`;
        div.appendChild(p);
        const orderBtn = document.createElement('button');
        orderBtn.textContent = 'ĐẶT HÀNG';
        orderBtn.className = 'order-btn ripple-btn';
        orderBtn.onclick = function(e) {
          openOrderPopup(item.ms, item["tên"], item["giá"], imgBaseUrl + item.ms + ".jpg");
          rippleEffect(e,this);
        };
        div.appendChild(orderBtn);
        dataDiv.appendChild(div);
      });
      hideLoader();
      rippleBtnInit();
      },350)
      const paginationDiv = document.getElementById('pagination');
      paginationDiv.innerHTML = '';
      const prevBtn = document.createElement('button');
      prevBtn.textContent = "Trang trước";
      prevBtn.disabled = page <= 1;
      prevBtn.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          renderPage(currentPage);
        }
      };
      paginationDiv.appendChild(prevBtn);
      const pageSpan = document.createElement('span');
      pageSpan.textContent = `Trang ${page} / ${totalPage}`;
      paginationDiv.appendChild(pageSpan);
      const nextBtn = document.createElement('button');
      nextBtn.textContent = "Trang sau";
      nextBtn.disabled = page >= totalPage;
      nextBtn.onclick = () => {
        if (currentPage < totalPage) {
          currentPage++;
          renderPage(currentPage);
        }
      };
      paginationDiv.appendChild(nextBtn);
    }
    function renderCatalogue() {
      const catDiv = document.getElementById('catalogue');
      catDiv.innerHTML = '';
      categories.forEach(cat => {
        const el = document.createElement('div');
        el.className = 'catalogue-item';
        el.textContent = cat.label;
        el.onclick = () => {
          if ((productsByCat[cat.key] || []).length > 0) {
            showCategory(cat.key);
          } else {
            alert('Hiện chưa có sản phẩm cho danh mục này!');
          }
        };
        catDiv.appendChild(el);
      });
    }
    function classifyProducts() {
      productsByCat = {};
      categories.forEach(cat => productsByCat[cat.key] = []);
      dataAll.forEach(item => {
        const ten = removeVietnameseTones((item["tên"] || "").toLowerCase());
        for (let cat of categories) {
          if (ten.includes(cat.keyword)) {
            productsByCat[cat.key].push(item);
            break;
          }
        }
      });
    }
    // Ripple effect cho nút
    function rippleEffect(e, btn) {
      const rect = btn.getBoundingClientRect();
      const circle = document.createElement('span');
      circle.className = 'ripple-anim';
      circle.style.width = circle.style.height = Math.max(rect.width, rect.height) + 'px';
      circle.style.left = (e.clientX - rect.left - rect.width/2) + 'px';
      circle.style.top = (e.clientY - rect.top - rect.height/2) + 'px';
      btn.appendChild(circle);
      setTimeout(()=>circle.remove(),600);
    }
    // Khởi tạo ripple cho tất cả nút mới render
    function rippleBtnInit() {
      document.querySelectorAll('.ripple-btn').forEach(btn=>{
        if(!btn.dataset.ripple){
          btn.addEventListener('click',function(e){rippleEffect(e,this)});
          btn.dataset.ripple = "1";
        }
      });
    }
    // Popup đặt hàng (hiện cả hình và giá) + hiệu ứng mượt
    function openOrderPopup(ms, ten, gia, imgUrl) {
      if (!gia || !imgUrl) {
        let sp = null;
        for (const cat in productsByCat) {
          sp = productsByCat[cat].find(item => (item.ms && item.ms.toString() === ms.toString()));
          if (sp) break;
        }
        if (sp) {
          gia = sp["giá"];
          ten = sp["tên"];
          imgUrl = imgBaseUrl + sp.ms + ".jpg";
        }
      }
      const popup = document.getElementById('order-popup');
      popup.style.display = 'flex';
      setTimeout(()=>popup.classList.add('show'),5);
      document.getElementById('popup-content').innerHTML =
        `<div style="margin-bottom:10px;">
          <img src="${imgUrl}" alt="${ten || ''}" style="max-width:220px;max-height:220px;border-radius:11px;box-shadow:0 2px 8px #0003;background:#fff;"><br>
          <div style="font-size:1.15em;margin-top:10px;color:#e2c275;">
            <b>Mã sản phẩm:</b> ${ms}<br>
            <b>Tên:</b> ${ten}<br>
            <b>Giá:</b> ${gia || ''}<br>
          </div>
        </div>
        <button onclick="navigator.clipboard.writeText('Mã: ${ms}, Tên: ${ten}');this.innerText='Đã copy!';setTimeout(()=>this.innerText='Copy mã',1500)" style="padding:7px 18px;border-radius:6px;background:#e2c275;color:#181818;font-weight:bold;border:none;cursor:pointer;">Copy mã</button>`;
      const messText = encodeURIComponent(`Shop ơi mình muốn đặt sản phẩm "${ms}"`);
      document.getElementById('popup-mess').href =
        `https://m.me/thuhien18102?text=${messText}`;
    }
    function closeOrderPopup() {
      const popup = document.getElementById('order-popup');
      popup.classList.remove('show');
      setTimeout(() => { popup.style.display = 'none'; }, 260);
    }
    // Cho phép nhấn Enter để tìm kiếm
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('search-input').addEventListener('keydown', function(e){
        if(e.key==='Enter'){ searchProduct(); }
      });
    });
    // Tải dữ liệu có skeleton loader
    showLoader(2);
    fetch(jsonUrl)
      .then(response => {
        if (!response.ok) throw new Error('Không lấy được file JSON');
        return response.json();
      })
      .then(data => {
        hideLoader();
        dataAll = data;
        classifyProducts();
        renderCatalogue();
        showCatalogue();
        showFeaturedProducts();
        renderTestimonials();
        rippleBtnInit();
      })
      .catch(error => {
        hideLoader();
        document.getElementById('catalogue').innerText = 'Lỗi: ' + error.message;
      });
  </script>
</body>
</html>
